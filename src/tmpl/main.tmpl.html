<div id="page" style="display: none;" data-bind="visible: true, css: { withToolbox: $root.showToolbox, withPreviewFrame: showPreviewFrame, desktop: $root.previewMode() == 'desktop', mobile: $root.previewMode() == 'mobile', large: $root.previewMode() == 'large' }, event: {click: function(data, event) { if ( !$.contains( $( '#testMenu' )[0], event.target ) ) { $root.showTestMenu(false); } return true;}}">
  <div id="main-edit-area" data-bind="click: function(obj, evt) { $root.selectBlock(null); return true; }, clickBubble: false">
    <!-- ko withProperties: { templateMode: 'wysiwyg', templateModeFallback: 'show' } -->
    <div id="main-wysiwyg-area" data-bind="wysiwygScrollfix: true, scrollable: true, fudroppable: { active: draggingImage }, css: { isdragging: dragging, isdraggingimg: draggingImage }, block: content"></div>
    <!-- /ko -->
  </div>

  <div id="toolbar" class="mo" data-bind="tooltips: {}">
    <!-- ko if: typeof $root.undo != 'undefined' -->
    <span data-bind="buttonset: { }" class="leftButtons">
    <a href="javascript:void(0)" data-bind="click: $root.undo.execute, clickBubble: false, button: { disabled: !$root.undo.enabled(), icon: 'fa fa-reply', label: $root.undo.name, text: true }">UNDO</a>
    <a href="javascript:void(0)" data-bind="click: $root.redo.execute, clickBubble: false, button: { disabled: !$root.redo.enabled(), icon: 'fa fa-share', label: $root.redo.name, text: true }">REDO</a>
    </span>
    <!-- ko if: $root.debug -->
    <a href="javascript:void(0)" data-bind="click: $root.undoReset, clickBubble: false, button: { disabled: !$root.undo.enabled() && !$root.redo.enabled(), label: 'reset', text: true }">RESET</a>
    <!-- /ko -->
    <!-- /ko -->

    <span>
      <input id="showGallery" type="checkbox" data-bind="checked: $root.showGallery, button: { refreshOn: $root.showGallery, icon: 'fa fa-fw fa-picture-o', text: true, label: $root.t('Gallery') }"><label for="showGallery">show gallery</label></input>
    </span>

    <span style="position:relative;">
      <input id="previewFrameToggle" type="checkbox" data-bind="checked: $root.showPreviewFrame, button: { refreshOn: $root.showPreviewFrame, icon: 'fa fa-fw fa-search', text: true, label: $root.t('Preview') }"><label for="previewFrameToggle">PREVIEW</label></input>
    </span>

    <!-- ko if: typeof $root.showSocialSharing !== 'undefined' -->
    <span>
      <input id="showSocialSharing" type="checkbox" data-bind="checked: $root.showSocialSharing, button: { refreshOn: $root.showSocialSharing, icon: 'fa fa-fw fa-share-alt', text: true, label: $root.t('Social Sharing') }"><label for="showSocialSharing">show social sharing</label></input>
    </span>
    <!-- /ko -->

    <!-- ko if: typeof $root.test !== 'undefined' -->
    <div id="testMenu">
      <a href="javascript:void(0)" data-bind="button: { icon: 'fa fa-fw fa-flask', label: $root.t('Test'), text: true }">TEST</a>
      <div>
        <!-- ko if: typeof $root.test.inboxPreview != 'undefined' -->
        <a href="javascript:void(0)" data-bind="click: $root.testMode.bind($root.testMode, 'inboxPreview'), clickBubble: false, button: { icon: 'fa fa-fw fa-search', label: $root.t('Inbox Preview Assistant'), text: true }">INBOX PREVIEW ASSISTANT</a>
        <!-- /ko -->
        <!-- ko if: typeof $root.test.send != 'undefined' -->
        <a href="javascript:void(0)" data-bind="click: $root.testMode.bind($root.testMode, 'send'), clickBubble: false, button: { icon: 'fa fa-fw fa-paper-plane-o', label: $root.t('Send a Test Email'), text: true }">SEND A TEST EMAIL</a>
        <!-- /ko -->
        <!-- ko if: typeof $root.test.spamassassin != 'undefined' -->
        <a href="javascript:void(0)" data-bind="click: $root.testMode.bind($root.testMode, 'spamassassin'), clickBubble: false, button: { icon: 'fa fa-fw fa-bolt', label: $root.t('Content Spam Checker'), text: true }">CONTENT SPAM CHECKER</a>
        <!-- /ko -->
      </div>
    </div>
    <!-- /ko -->

    <span id="variation-toolbar-wrapper" style="position:relative;" data-bind="visible: $root.splitTestingEnabled">
      <label class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary" role="label" aria-disabled="false" aria-pressed="false">
        <span class="ui-button-icon-primary ui-icon fa fa-fw fa-random"></span>
        <span class="ui-button-text" data-bind="text: $root.t('Variation:')">Variation:</span>
      </label>
      <div id="variation-toolbar" style="display: inline-block;">
        <div data-bind="visible: true, buttonset: { refreshOn: $root.currentVariationIndex }" style="display: inline-block" class="ui-buttonset">
          <input id="variationA" type="radio" name="variation" value="0" data-bind="checked: $root.currentVariationIndex, button: { text: true, label: 'A' }">
          <label for="variationA">A</label>
          <input id="variationB" type="radio" name="variation" value="1" data-bind="checked: $root.currentVariationIndex, button: { text: true, label: 'B' }">
          <label for="variationB">B</label>
        </div>
      </div>
    </span>

    <!-- ko if: $root.debug -->
    <a href="javascript:void(0)" data-bind="click: $root.export, clickBubble: false, button: { label: 'export', text: true }">EXPORT</a>
    <input type="checkbox" data-bind="checked: $root.debug" /> debug
    <a href="javascript:void(0)" data-bind="click: $root.loadDefaultBlocks, clickBubble: false, button: { icon: 'fa fa-fw fa-upload', label: 'Default', text: true }">LOAD BLOCKS</a>
    [<a id="subscriptionsCount" href="javascript:viewModel.loopSubscriptionsCount()">subs</a>]
    <!-- /ko -->

    <span data-bind="visible: false">
    <input type="checkbox" data-bind="checked: $root.showToolbox" /> toolbox
    </span>

    <div class="rightButtons">
    <!-- ko if: typeof $root.save !== 'undefined' -->
    <a title="Save template" href="javascript:void(0)" data-bind="attr: { title: $root.t('Save template') }, click: $root.save.execute, clickBubble: false, button: { disabled: !$root.save.enabled(), icons: { primary: 'fa fa-fw fa-cloud-upload' }, label: $root.t($root.save.name), text: true }">SALVA</a>
    <!-- /ko -->
    <!-- ko if: typeof $root.test !== 'undefined' -->
    <a title="Show preview and send test" href="javascript:void(0)" data-bind="attr: { title: $root.t('Show preview and send test') }, click: $root.test.execute, clickBubble: false, button: { disabled: !$root.test.enabled(), icons: { primary: 'fa fa-fw fa-paper-plane' }, label: $root.t($root.test.name), text: true }">TEST</a>
    <!-- /ko -->
    <!-- ko if: typeof $root.download !== 'undefined' -->
    <form id="downloadForm" action="#" method="POST">
      <input type="hidden" name="action" value="download" />
      <input type="hidden" name="filename" value="email.html" />
      <input type="hidden" name="html" id="downloadHtmlTextarea" />
      <a href="javascript:void(0)" data-bind="click: $root.download.execute, clickBubble: false, button: { disabled: !$root.download.enabled(), icon: 'fa fa-fw fa-download', label: $root.t($root.download.name), text: true }">DOWNLOAD</a>
    </form>
    <!-- /ko -->
    <!-- ko if: $root.developerMode -->
    <a href="javascript:void(0)" data-bind="click: $root.exportTemplate.execute, clickBubble: false, button: { disabled: !$root.exportTemplate.enabled(), icon: 'fa fa-fw fa-file-archive-o', label: $root.t($root.exportTemplate.name), text: true }">EXPORT TEMPLATE</a>
    <!-- /ko -->
    <!-- ko if: typeof $root.continue !== 'undefined' -->
    <div id="saveMenu">
      <a href="javascript:void(0)" data-bind="click: $root.continue.execute.bind($element, true) , clickBubble: false, button: { disabled: !$root.continue.enabled(), icon: 'fa fa-fw fa-arrow-circle-right', label: $root.t($root.continue.name), text: true }">SAVE AND CONTINUE</a>
      <div>
        <a href="javascript:void(0)" data-bind="click: $root.continue.execute.bind($element, false), clickBubble: false, button: { disabled: !$root.continue.enabled(), icon: 'fa fa-fw fa-floppy-o', label: $root.t($root.continue.name2), text: true }">SAVE</a>
      </div>
    </div>
    <!-- /ko -->
    </div>
  </div>

  <div id="main-toolbox" class="mo" data-bind="scrollable: true, withProperties: { templateMode: 'edit' }">
    <div data-bind="template: { name: 'toolbox' }"></div>
  </div>
  
  <div id="main-preview" class="mo" data-bind="scrollable: true">
    <div id="preview-toolbar">
      <div data-bind="visible: true, css: { hiddenPreview: !$root.showPreviewFrame() }, buttonset: { refreshOn: $root.previewMode }" style="display: inline-block">
        <input id="previewLarge" type="radio" name="previewMode" value="large" data-bind="checked: $root.previewMode, button: { text: false, label: 'desktop', icon: 'fa fa-fw fa-desktop' }" />
        <label for="previewLarge">Desktop</label>
        <input id="previewDesktop" type="radio" name="previewMode" value="desktop" data-bind="checked: $root.previewMode, button: { text: false, label: 'tablet', icon: 'fa fa-fw fa-tablet' }" />
        <label for="previewDesktop">Tablet</label>
        <input id="previewMobile" type="radio" name="previewMode" value="mobile" data-bind="checked: $root.previewMode, button: { text: false, label: 'mobile', icon: 'fa fa-fw fa-mobile' }" />
        <label for="previewMobile">Mobile</label>
      </div>
    </div>

    <div id="frame-container" data-bind="css: { desktop: $root.previewMode() == 'desktop', mobile: $root.previewMode() == 'mobile', large: $root.previewMode() == 'large' }">
      <iframe data-bind="bindIframe: $data"></iframe>
    </div>
  </div>

  <div class="mo" id="mo-body"></div>

  <div id="incompatible-template" title="Saved model is obsolete" style="display: none" data-bind="attr: { title: $root.t('Saved model is obsolete') }, html: $root.t('<p>The saved model has been created with a previous, non completely compatible version, of the template</p><p>Some content or style in the model <b>COULD BE LOST</b> if you will <b>save</b></p><p>Contact us for more informations!</p>')">
    Incompatible template
  </div>

  <div id="fake-image-editor" title="Fake image editor" style="display: none" data-bind="attr: { title: $root.t('Fake image editor') }, html: $root.t('<p>Fake image editor</p>')">
    <p>Fake image editor</p>
  </div>
</div>

<!-- ko if: $root.logoPath -->
<div id="loading" class="loading" style="display: block; width: 300px; text-align: center; height: 32px; position: absolute; top:0; bottom: 0; left: 0; right: 0;  margin: auto;" data-bind="attr: { style: 'position: absolute; top: 5px; left: 6px; z-index: 150;'}, css: { loading: false }">
  <a href="/" data-bind="attr: { href: $root.logoUrl, alt: $root.logoAlt }"><img data-bind="attr: { src: $root.logoPath }" width="32" height="32" alt="mosaico" border="0" /></a>
  <div style="opacity: 0" data-bind="visible: false">Oops... !!</div>
</div>
<!-- /ko -->